webpackJsonp([16],{"1alW":function(t,e,a){var i=a("kM2E");i(i.S,"Number",{isInteger:a("AKgy")})},AKgy:function(t,e,a){var i=a("EqjI"),n=Math.floor;t.exports=function(t){return!i(t)&&isFinite(t)&&n(t)===t}},C3kP:function(t,e){},"RRo+":function(t,e,a){t.exports={default:a("c45H"),__esModule:!0}},c45H:function(t,e,a){a("1alW"),t.exports=a("FeBl").Number.isInteger},qsWe:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("RRo+"),n=a.n(i),s={name:"",data:function(){return{filterText:"",stfilterText:"",stationData:[],value:"",loading:!0,visiDialog:!1,searchModel:"",vTitle:"角色新增",tableData:[],roleId:"",formData:{roleName:"",seqNum:"",description:""},rules:{roleName:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:1,max:25,message:"长度在 1 到 25 个字符",trigger:"blur"}],seqNum:[{validator:function(t,e,a){if(!e)return a(new Error("序号不能为空"));n()(e)?a():a(new Error("请输入数字值并且不为负数"))},trigger:"blur"}]},currentPage:1,total:0,pageSize:10,pageList:[10,15,20],isEditor:!1,menuVisiDialog:!1,stVisiDialog:!1,menuData:[],defaultProps:{children:"children",label:"name"},stdefaultProps:{children:"children",label:"nodeName"},defaultId:[],stdefaultId:[]}},inject:["globelDelet"],created:function(){this.init(),this.getMenuData(),this.getList()},mounted:function(){},methods:{filterNode:function(t,e){return!t||-1!==e.name.indexOf(t)},stfilterNode:function(t,e){return!t||-1!==e.stationName.indexOf(t)},init:function(){var t=this;this.$http.get("/SiteManagement/station/queryTree",{params:{keyName:"",typeCode:"",isUsedString:"",isMonitoring:"",basinnOrAreaOrCustom:"area",groupName:"",groupStations:""}}).then(function(e){if(0==e.data.code){var a;a=e.data.content.dataList,t.stationData.push({nodeName:"全部",nodeId:"quanbu",children:a})}})},selectChange:function(t,e){var a=t;for(var i in this.roleId="",a)this.roleId+=a[i].roleId+",";this.roleId=this.roleId.substring(0,this.roleId.length-1)},paginationSizeChange:function(t){this.pageSize=t,this.getList()},paginationChange:function(t){this.currentPage=t,this.getList()},addRole:function(){this.isEditor=!1,this.visiDialog=!0},submit:function(t){var e=this;this.$refs[t].validate(function(a){if(!a)return!1;if(e.isEditor){var i=new FormData;i.append("roleName",e.formData.roleName),i.append("seqNum",e.formData.seqNum),i.append("description",e.formData.description),i.append("roleId",e.roleId),e.$http.put("AuthorityManagement/roles",i).then(function(a){0==a.data.code&&(e.resetForm(t),e.visiDialog=!1,e.getList(),e.$message({message:a.data.message,type:"success",duration:1e3}))})}else{var n=new FormData;n.append("roleName",e.formData.roleName),n.append("seqNum",e.formData.seqNum),n.append("description",e.formData.description),e.$http.post("AuthorityManagement/roles",n).then(function(a){0==a.data.code&&(e.resetForm(t),e.visiDialog=!1,e.getList(),e.$message({message:a.data.message,type:"success",duration:1e3}))})}})},revise:function(t){this.isEditor=!0,this.visiDialog=!0,this.formData.roleName=t.roleName,this.formData.seqNum=t.seqNum,this.formData.description=t.description,this.roleId=t.roleId},delet:function(t){this.globelDelet("/AuthorityManagement/roles/ids",t,this.getList)},allDelet:function(){this.globelDelet("/AuthorityManagement/roles/ids",this.roleId,this.getList)},getList:function(){var t=this;this.loading=!0,this.$http.get("AuthorityManagement/roles",{params:{pageSize:this.pageSize,pageNo:this.currentPage,roleName:this.searchModel}}).then(function(e){t.tableData=e.data.content.dataList,t.total=e.data.content.totalRecords,t.loading=!1})},search:function(){this.getList()},resetForm:function(t){this.$refs[t].resetFields(),this.formData.description="",this.formData.roleId=""},cancel:function(t){this.resetForm(t),this.visiDialog=!1},closess:function(t){t(),this.resetForm("ruleForm")},getMenuData:function(){var t=this;this.$http.get("AuthorityManagement/permissions/menus").then(function(e){t.menuData=e.data.content.dataList})},submitMenu:function(){var t=this,e=this.$refs.menuTree.getCheckedNodes(!1,!0),a=[];for(var i in e)a.push(e[i].id);var n=new FormData;n.append("roleId",this.roleId),n.append("permissionIds",a.join(",")),this.$http.post("AuthorityManagement/roles/permissions/ids",n).then(function(e){0==e.data.code&&(t.$message({message:e.data.message,type:"success",duration:1500}),t.menuVisiDialog=!1)})},submitStation:function(){var t=this.$refs.stationTree.getCheckedNodes(!1,!0),e=[];for(var a in console.log(t),t)"quanbu"!=t[a].nodeId&&null!=t[a].stationId&&e.push(t[a].stationId);var i=new FormData;return i.append("roleId",this.roleId),i.append("stationIds",e.join(",")),!1},setMenu:function(t){var e=this;this.roleId=t,this.filterText="",this.menuVisiDialog=!0,this.$http.get("AuthorityManagement/roles/rolePermissions",{params:{roleId:this.roleId}}).then(function(t){var a=t.data.content.dataList;for(var i in e.defaultId=[],e.$refs.menuTree.setCheckedNodes([]),a)2!=a[i].permissionLevel&&"GIS一张图"!=a[i].permissionName&&"知识库"!=a[i].permissionName||e.defaultId.push(a[i].permissionId)})},cancelmSub:function(){this.menuVisiDialog=!1},cancelsSub:function(){this.stVisiDialog=!1},setStation:function(t){var e=this;this.roleId=t,this.stfilterText="",this.stVisiDialog=!0,this.$http.get("AuthorityManagement/roles/roleStations",{params:{roleId:this.roleId}}).then(function(t){var a=t.data.content.dataList;for(var i in e.stdefaultId=[],e.$refs.stationTree.setCheckedNodes([]),a)e.stdefaultId.push(a[i].stationId);console.log(e.stdefaultId)})}},computed:{totalPageNumber:function(){return Math.ceil(this.total/this.pageSize)}},watch:{filterText:function(t){this.$refs.menuTree.filter(t)},stfilterText:function(t){this.$refs.stationTree.filter(t)}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"trafficpage secondary-page-mode"},[a("div",{staticClass:"secondary-toolbar"},[a("span",[t._v("关键字 : ")]),t._v(" "),a("div",{staticClass:"layoutBox",staticStyle:{width:"220px"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.searchModel,callback:function(e){t.searchModel=e},expression:"searchModel"}})],1),t._v("  \n         "),a("el-button",{on:{click:t.search}},[a("i",{staticClass:"iconfont icon-sousuo"}),t._v("查询")]),t._v(" "),a("el-button",{on:{click:t.addRole}},[a("i",{staticClass:"iconfont icon-tianjia"}),t._v("新增")]),t._v(" "),a("el-button",{attrs:{type:"delet"},on:{click:t.allDelet}},[a("i",{staticClass:"iconfont icon-shanchu"}),t._v("批量删除")])],1),t._v(" "),a("div",{staticClass:"currency-mode-wrap"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{border:"",data:t.tableData,height:"calc(100% - 30px)","element-loading-text":"加载中","element-loading-spinner":"loading-type-a","element-loading-background":"rgba(255, 255, 255, 1)"},on:{"selection-change":t.selectChange}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"roleName",width:"300",label:"角色名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述"}}),t._v(" "),a("el-table-column",{attrs:{label:"资源配置",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("el-button",{attrs:{type:"secondBtn"},on:{click:function(a){return t.setMenu(e.row.roleId)}}},[t._v("菜单配置")]),t._v(" "),a("el-button",{attrs:{type:"secondBtn"},on:{click:function(a){return t.setStation(e.row.roleId)}}},[t._v("站点配置")])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("el-button",{attrs:{type:"secondBtn"},on:{click:function(a){return t.revise(e.row)}}},[t._v("修改")]),t._v(" "),a("el-button",{attrs:{type:"secondBtn"},on:{click:function(a){return t.delet(e.row.roleId)}}},[t._v("删除")])],1)]}}])})],1),t._v(" "),a("div",{staticClass:"table-pagination-wrap"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,"popper-class":"select-pagination-option",background:"",small:!0,"page-sizes":t.pageList,layout:"total, sizes, slot,->,prev, pager, next, jumper",total:t.total},on:{"size-change":t.paginationSizeChange,"current-change":t.paginationChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}},scopedSlots:t._u([{key:"default",fn:function(){return[a("span",{staticClass:"el-pagination__current"},[t._v("当前第"+t._s(t.currentPage)+"/"+t._s(t.totalPageNumber)+"页")])]},proxy:!0}])})],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.visiDialog,width:"920px",title:t.vTitle,"before-close":t.closess},on:{"update:visible":function(e){t.visiDialog=e}}},[a("div",{staticClass:"dialogcontent"},[a("el-form",{ref:"ruleForm",attrs:{model:t.formData,rules:t.rules}},[a("table",{staticClass:"whTable"},[a("tr",[a("td",{attrs:{width:"16.5%"}},[a("span",{staticClass:"rCode"},[t._v("用户名称")])]),t._v(" "),a("td",[a("el-form-item",{attrs:{prop:"roleName"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.formData.roleName,callback:function(e){t.$set(t.formData,"roleName",e)},expression:"formData.roleName"}})],1)],1),t._v(" "),a("td",{attrs:{width:"16.5%"}},[a("span",[t._v("序号")])]),t._v(" "),a("td",[a("el-form-item",{attrs:{prop:"seqNum"}},[a("el-input",{attrs:{placeholder:"请输入"},model:{value:t.formData.seqNum,callback:function(e){t.$set(t.formData,"seqNum",t._n(e))},expression:"formData.seqNum"}})],1)],1)]),t._v(" "),a("tr",[a("td",{attrs:{width:"16.5%"}},[a("span",[t._v("描述")])]),t._v(" "),a("td",{attrs:{colspan:"3"}},[a("el-input",{attrs:{placeholder:"请输入",type:"textarea"},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1)])])])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){return t.submit("ruleForm")}}},[t._v("提交")]),t._v(" "),a("el-button",{attrs:{type:"noticonsecondBtn"},on:{click:function(e){return t.cancel("ruleForm")}}},[t._v("取消")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.menuVisiDialog,width:"450px",title:"菜单配置"},on:{"update:visible":function(e){t.menuVisiDialog=e}}},[a("div",{staticClass:"dialogcontent tree_content",staticStyle:{height:"300px",padding:"0px"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("div",{staticStyle:{width:"255px","margin-bottom":"12px"}},[a("el-input",{attrs:{placeholder:"请输入菜单名","suffix-icon":"el-icon-search"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),t._v(" "),a("el-tree",{ref:"menuTree",class:1==t.menuData.length?"noBr":"",attrs:{data:t.menuData,indent:23,"node-key":"id","default-checked-keys":t.defaultId,"default-expand-all":"","highlight-current":"","show-checkbox":"","filter-node-method":t.filterNode,props:t.defaultProps},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{staticClass:"iconCode",class:"0"==n.level?"sf":"1"==n.level?"sf":"2"==n.level?"city":""}),t._v("\n                          "+t._s(i.label)+"\n                        ")])])}}])})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.submitMenu}},[t._v("提交")]),t._v(" "),a("el-button",{attrs:{type:"noticonsecondBtn"},on:{click:t.cancelmSub}},[t._v("取消")])],1)]),t._v(" "),a("el-dialog",{attrs:{visible:t.stVisiDialog,width:"450px",title:"站点配置"},on:{"update:visible":function(e){t.stVisiDialog=e}}},[a("div",{staticClass:"dialogcontent tree_content",staticStyle:{height:"300px",padding:"0px"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("div",{staticStyle:{width:"255px","margin-bottom":"12px"}},[a("el-input",{attrs:{placeholder:"请输入站点名","suffix-icon":"el-icon-search"},model:{value:t.stfilterText,callback:function(e){t.stfilterText=e},expression:"stfilterText"}})],1),t._v(" "),a("el-tree",{ref:"stationTree",class:1==t.stationData.length?"noBr":"",attrs:{data:t.stationData,indent:23,"node-key":"nodeId","default-checked-keys":t.stdefaultId,"default-expand-all":"","highlight-current":"","show-checkbox":"","filter-node-method":t.stfilterNode,props:t.stdefaultProps},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,n=e.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{staticClass:"iconCode",class:"quanbu"==n.stationId?"sf":"station"}),t._v("\n                        "+t._s(i.label)+"\n                      ")])])}}])})],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.submitStation}},[t._v("提交")]),t._v(" "),a("el-button",{attrs:{type:"noticonsecondBtn"},on:{click:t.cancelsSub}},[t._v("取消")])],1)])],1)},staticRenderFns:[]};var r=a("VU/8")(s,o,!1,function(t){a("C3kP")},"data-v-0d78aed8",null);e.default=r.exports}});
//# sourceMappingURL=16.001f66561796eec0a8b7.js.map