webpackJsonp([56],{kwMV:function(t,a){},uNI5:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i={shortcuts:[{text:"最近一周",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",[e,a])}},{text:"最近一个月",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-2592e6),t.$emit("pick",[e,a])}},{text:"最近三个月",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-7776e6),t.$emit("pick",[e,a])}}]},s=[{name:"实时",type:"minute"},{name:"日评价",type:"day"},{name:"周评价",type:"week"},{name:"月评价",type:"month"},{name:"季评价",type:"season"},{name:"年评价",type:"year"},{name:"自定义",type:"custom"}],n={name:"waterQualityEvaluationD",props:["nodes"],watch:{nodes:function(){this.searchData()}},data:function(){return{trendLoading:!0,trendNoDataState:!1,detailsLoading:!0,detailsNoDataState:!1,dataValue:"",pickerOptions:i,dataType:0,dataTypeList:s,custom:!0,tableData:[],currentPage:1,total:62,pageSize:10,pageList:[10,15,20],myChart:"",detailsTrend:"",evaluation:"",targetQualityLevel:"",timerange:"",headtitle:"",analydetal:""}},computed:{totalPageNumber:function(){return Math.ceil(this.total/this.pageSize)}},methods:{toWQLString:function(t){return"1"==t?"Ⅰ类":"2"==t?"Ⅱ类":"3"==t?"Ⅲ类":"4"==t?"Ⅳ类":"5"==t?"Ⅴ类":"6"==t?"劣Ⅴ类":""},dataTypeToggle:function(t,a){this.dataType=t,"custom"===a.type?this.custom=!1:(this.custom=!0,this.dataValue="");var e=this.dataTypeList[t].type,i=new Date,s=[];if("minute"==e)s.push(i,i);else if("day"==e){var n=new Date(formatDate(i,"yyyy-MM-dd 00:00:00"));s.push(new Date(n.getTime()-864e5),i)}else if("week"==e){n=new Date(formatDate(i,"yyyy-MM-dd 00:00:00"));s.push(new Date(n.getTime()-6048e5),i)}else if("month"==e){n=new Date(formatDate(i,"yyyy-MM-01 00:00:00"));s.push(new Date(n.getTime()),i)}else if("season"==e){n=new Date(formatDate(i,"yyyy-MM-01 00:00:00"));var l=new Date(formatDate(new Date(n.getTime()-864e5),"yyyy-MM-01 00:00:00")),r=new Date(formatDate(new Date(l.getTime()-864e5),"yyyy-MM-01 00:00:00"));s.push(new Date(r.getTime()),i)}else if("year"==e){n=new Date(formatDate(i,"yyyy-01-01 00:00:00"));s.push(new Date(n.getTime()),i)}this.dataValue=s},initTime:function(){var t=new Date,a=[];a.push(t,t),this.dataValue=a},searchData:function(){this.$emit("update:loading",!0),this.checksiteinit(),this.stationDetail(),this.waterConcentrationChart(),this.detailsTrendChart()},frountpage:function(t){this.total=t.length;var a=(this.currentPage-1)*this.pageSize,e=this.pageSize*this.currentPage,i=[],s=e;e>t.length&&(s=t.length);for(var n=a;n<s;n++)i.push(t[n]);this.tableData=i},checksiteinit:function(){var t=this,a=setInterval(function(){t.nodes.id&&(t.evaluate(),t.headtitle=t.nodes.label+"水质评价",clearInterval(a))},100)},evaluate:function(){var t=this,a=this.dataTypeList[this.dataType].type,e=formatDate(this.dataValue[0],"yyyy-MM-dd hh:mm:ss"),i=formatDate(this.dataValue[1],"yyyy-MM-dd hh:mm:ss"),s={queryType:"station",statisType:a,startTime:e,endTime:i,equipdIds:this.nodes.id};this.$http.get("/waterenvapi/station/realStatisInfo",{params:s}).then(function(a){var s=a.data;if(200===s.code){var n=s.content.dataList;if(n.length>0)t.evaluation=n[0].evaluation,t.targetQualityLevel=t.toWQLString(n[0].targetQualityLevel),2==t.dataValue.length&&(t.timerange=e+"至"+i),t.analydetal="水质概述："+t.timerange+"，"+t.nodes.label+"水质等级为"+n[0].waterQualityLevel+"，主要污染物为"+n[0].primaryPollutant}}).catch(function(t){})},stationDetail:function(){var t=this,a={queryType:"station",statisType:this.dataTypeList[this.dataType].type,startTime:formatDate(this.dataValue[0],"yyyy-MM-dd hh:mm:ss"),endTime:formatDate(this.dataValue[1],"yyyy-MM-dd hh:mm:ss"),equipdIds:this.nodes.id};this.$http.get("/waterenvapi/station/projectStatisInfo",{params:a}).then(function(a){var e=a.data;if(200===e.code){var i=e.content.dataList;t.frountpage(i)}}).catch(function(t){})},paginationChange:function(t){this.currentPage=t},paginationSizeChange:function(t){this.currentPage=t},waterConcentrationChart:function(){var t=this;this.trendLoading=!0,this.trendNoDataState=!1,this.myChart=this.$echarts.init(document.getElementById("trend-change-chart"));var a={queryType:"station",statisType:this.dataTypeList[this.dataType].type,startTime:formatDate(this.dataValue[0],"yyyy-MM-dd hh:mm:ss"),endTime:formatDate(this.dataValue[1],"yyyy-MM-dd hh:mm:ss"),equipdIds:this.nodes.id};this.$http.get("/waterenvapi/station/projectStatisChart",{params:a}).then(function(a){var e=a.data;if(200===e.code){var i=e.content.info,s=i.xAxis,n=i.yAxis[0].list,l=i.yAxis[1].list;0===l.length?t.trendNoDataState=!0:t.trendNoDataState=!1;var r={color:["#2675d1"],title:{text:"水质排名详情",textStyle:{fontSize:16},subtext:"数据来源：小时数据",subtextStyle:{color:"#333"},x:"center",y:10},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:66,left:20,right:"4%",bottom:30,containLabel:!0},legend:{bottom:0,data:["目标水质"]},visualMap:{top:10,right:-100,pieces:[{value:1,color:"#00a1e4"},{value:2,color:"#00a1e4"},{value:3,color:"#24c768"},{value:4,color:"#e5ce10"},{value:5,color:"#ff7e00"},{value:6,color:"#ff7e00"}],outOfRange:{color:"#999"}},xAxis:[{type:"category",data:s,axisTick:{show:!1},axisLine:{lineStyle:{color:"#c6d1de"}},axisLabel:{color:"#999"},splitLine:{show:!0}}],yAxis:[{type:"value",splitNumber:7,max:6,axisTick:{show:!1},axisLine:{lineStyle:{color:"#c6d1de"}},axisLabel:{color:"#999",formatter:function(t){var a=null;switch(t){case 0:a="";break;case 1:a="Ⅰ类";break;case 2:a="Ⅱ类";break;case 3:a="Ⅲ类";break;case 4:a="Ⅳ类";break;case 5:a="Ⅴ类";break;case 6:a="劣Ⅴ类"}return a}},splitLine:{show:!0}}],series:[{name:"断面实际水质",type:"bar",data:n,barWidth:20},{name:"目标水质",type:"line",symbolSize:10,lineStyle:{color:"#2675d1"},itemStyle:{borderColor:"#2675d1"},data:l}]};t.myChart.setOption(r)}t.trendLoading=!1}).catch(function(a){t.trendLoading=!1,t.trendNoDataState=!0})},detailsTrendChart:function(){var t=this;this.detailsLoading=!0,this.detailsNoDataState=!1,this.detailsTrend=this.$echarts.init(document.getElementById("details-trend-chart"));this.dataTypeList[this.dataType].type;var a=formatDate(this.dataValue[0],"yyyy-MM-dd hh:mm:ss"),e=formatDate(this.dataValue[1],"yyyy-MM-dd hh:mm:ss"),i={equipdIds:this.nodes.id,statisType:"hour",startTime:a,endTime:e};this.$http.get("/waterenvapi/station/projectValueTrendChart",{params:i}).then(function(a){var e=a.data;if(200===e.code){for(var i=e.content.info,s=[],n=0;n<i.legend.length;n++)s.push(i.legend[n]);var l=[],r=i.yAxis;for(n=0;n<r.length;n++){var o=r[n];l.push({name:o.name,type:"line",symbolSize:8,data:o.list})}0===l.length?t.detailsNoDataState=!0:t.detailsNoDataState=!1;var c={color:["#166bce","#ff7e00","#ce1768","#11c053","#9c16ce","#22c0ce"],tooltip:{trigger:"axis"},legend:{data:s,bottom:0},grid:{top:20,left:40,right:20,bottom:30,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:i.xAxis,axisTick:{show:!1},axisLine:{lineStyle:{color:"#c6d1de"}},axisLabel:{color:"#999"},splitLine:{show:!0}},yAxis:{type:"value",name:"监测值",nameLocation:"middle",nameTextStyle:{color:"#999"},nameGap:40,axisTick:{show:!1},splitNumber:10,axisLine:{lineStyle:{color:"#c6d1de"}},axisLabel:{color:"#999"}},series:l};t.detailsTrend.setOption(c)}t.detailsLoading=!1}).catch(function(a){t.detailsLoading=!1,t.detailsNoDataState=!0})}},mounted:function(){this.initTime();var t=this;window.addEventListener("resize",function(){t.myChart.resize(),t.detailsTrend.resize()}),this.searchData()}},l={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"water-quality-evaluation-page"},[e("div",{staticClass:"secondary-scroll-content"},[e("h4",{staticClass:"statistical-analysis-title"},[t._v(" "+t._s(t.headtitle)+" ")]),t._v(" "),e("div",{staticClass:"secondary-toolbar"},[e("span",[t._v("时间段：")]),t._v(" "),e("el-button-group",t._l(t.dataTypeList,function(a,i){return e("el-button",{key:i,class:{active:t.dataType===i},attrs:{size:"small",type:"primary",plain:""},on:{click:function(e){return t.dataTypeToggle(i,a)}}},[t._v(t._s(a.name))])}),1),t._v(" "),e("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",clearable:!1,format:"yyyy-MM-dd HH:mm","prefix-icon":"el-icon-date",disabled:t.custom,"picker-options":t.pickerOptions},model:{value:t.dataValue,callback:function(a){t.dataValue=a},expression:"dataValue"}}),t._v(" \n      "),e("button",{staticClass:"default-btn",attrs:{type:"button"},on:{click:t.searchData}},[e("i",{staticClass:"iconfont icon-shijiantai"}),t._v(" 评价\n      ")])],1),t._v(" "),e("div",{staticClass:"currency-mode-wrap"},[t._m(0),t._v(" "),e("div",{staticClass:"secondary-mode-content"},[e("div",{staticClass:"normal-table-wrap"},[e("table",{staticClass:"normal-table"},[e("tr",[e("th",[t._v("水质现状")]),t._v(" "),e("td",[e("i",{staticClass:"sl-icon gradeC"}),t._v(" "+t._s(t.evaluation))]),t._v(" "),e("th",[t._v("水质目标")]),t._v(" "),e("td",[e("i",{staticClass:"sl-icon gradeB"}),t._v(" "+t._s(t.targetQualityLevel))]),t._v(" "),e("th",[t._v("联网现状")]),t._v(" "),t._m(1)]),t._v(" "),e("tr",[e("th",[t._v("计算方法")]),t._v(" "),e("td",[t._v("比例法")]),t._v(" "),e("th",[t._v("数据时间")]),t._v(" "),e("td",{attrs:{colspan:"3"}},[t._v(t._s(t.timerange))])])])]),t._v(" "),e("div",{staticClass:"statistical-analysis-text"},[e("p",[t._v(t._s(t.analydetal))])]),t._v(" "),t._m(2),t._v(" "),e("div",{staticClass:"water-quality-row"},[e("div",{staticClass:"water-quality-table-wrap"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),e("el-table-column",{attrs:{prop:"time",label:"数据时间"}}),t._v(" "),e("el-table-column",{attrs:{prop:"name",label:"监测因子"}}),t._v(" "),e("el-table-column",{attrs:{prop:"value",label:"浓度值"}}),t._v(" "),e("el-table-column",{attrs:{prop:"waterQualityLevel",label:"水质等级"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v("\n                    "+t._s(t.toWQLString(a.row.waterQualityLevel))+"\n                  ")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"downfivestandar",label:"V类水标准"}}),t._v(" "),e("el-table-column",{attrs:{prop:"unit",label:"单位"}})],1)],1),t._v(" "),e("div",{staticClass:"table-pagination-wrap"},[e("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,background:"",small:!0,"popper-class":"select-common-option","page-sizes":t.pageList,layout:"total, sizes, slot ,->,prev, pager, next, jumper",total:t.total},on:{"size-change":t.paginationSizeChange,"current-change":t.paginationChange,"update:currentPage":function(a){t.currentPage=a},"update:current-page":function(a){t.currentPage=a}}},[e("span",{staticClass:"el-pagination__current"},[t._v("当前第"+t._s(t.currentPage)+"/"+t._s(t.totalPageNumber)+"页")])])],1)]),t._v(" "),e("h4",{staticClass:"secondary-mode-title"},[e("i",{staticClass:"sl-icon block-icon"}),t._v(" "),e("span",[t._v(t._s(t.headtitle)+"各因子水质详情")])]),t._v(" "),e("div",{staticClass:"water-chart-wrap"},[t.trendLoading?e("div",{staticClass:"loading-wrap"}):t._e(),t._v(" "),t.trendNoDataState?e("div",{staticClass:"no-data-wrap small no-data-chart"},[e("p",[t._v("暂无数据")])]):t._e(),t._v(" "),t._m(3),t._v(" "),e("div",{attrs:{id:"trend-change-chart"}})]),t._v(" "),e("h4",{staticClass:"secondary-mode-title"},[e("i",{staticClass:"sl-icon block-icon"}),t._v(" "),e("span",[t._v(t._s(t.headtitle)+"各因子趋势详情")])]),t._v(" "),e("div",{staticClass:"water-chart-wrap"},[t.detailsLoading?e("div",{staticClass:"loading-wrap"}):t._e(),t._v(" "),t.detailsNoDataState?e("div",{staticClass:"no-data-wrap small no-data-chart"},[e("p",[t._v("暂无数据")])]):t._e(),t._v(" "),e("div",{attrs:{id:"details-trend-chart"}})])])])])])},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("h4",{staticClass:"currency-mode-title"},[a("i",{staticClass:"mode-title-icon"}),this._v(" 水质评价\n        "),a("span",{staticClass:"mode-title-line"})])},function(){var t=this.$createElement,a=this._self._c||t;return a("td",[a("i",{staticClass:"sl-icon gradeB"}),this._v(" 正常")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h4",{staticClass:"secondary-mode-title"},[a("i",{staticClass:"sl-icon block-icon"}),this._v(" "),a("span",[this._v("奉贤区断面水质详情")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",{staticClass:"color-line-list"},[a("li",{staticClass:"grade1"}),this._v(" "),a("li",{staticClass:"grade2"}),this._v(" "),a("li",{staticClass:"grade3"}),this._v(" "),a("li",{staticClass:"grade4"}),this._v(" "),a("li",{staticClass:"grade5"}),this._v(" "),a("li",{staticClass:"grade6"})])}]};var r=e("VU/8")(n,l,!1,function(t){e("kwMV")},"data-v-6f210cf0",null);a.default=r.exports}});
//# sourceMappingURL=56.7b07041687216f9f1e10.js.map